<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Last Witnesses – Vertical Timeline</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: Georgia, serif;
      overflow-y: auto;
    }
    #defaultCanvas0 {
      display: block;
    }
  </style>
</head>
<body>
<script>
// ==================== Data ====================
const builtInData = [
  { "name": "La Brea Owl", "scientificName": "Oraristic brea", "lastSeen": "10250–9180 BC", "year": -10250, "image": "la_brea_owl.png", "causeOfExtinction": ["Climate Change", "Competition with Homo Sapiens"] },
  { "name": "Irish Elk", "scientificName": "Megaloceros giganteus", "lastSeen": "7700 BC", "year": -7700, "image": "irish_elk.png", "causeOfExtinction": ["Climate change", "Hunting"] },
  { "name": "Woolly Mammoth", "scientificName": "Mammuthus primigenius", "lastSeen": "2000 BC", "year": -2000, "image": "woolly_mammoth.png", "causeOfExtinction": ["Climate change", "Human hunting"] },
  { "name": "Giant Moa", "scientificName": "Dinornis spp.", "lastSeen": "1400", "year": 1400, "image": "giant_moa.png", "causeOfExtinction": ["Overhunting by humans"] },
  { "name": "Bermuda Saw-whet Owl", "scientificName": "Aegolius gradyi", "lastSeen": "1609–1610", "year": 1610, "image": "bermuda_saw_whet_owl.png", "causeOfExtinction": ["Habitat destruction", "Introduced predators"] },
  { "name": "Elephant Bird", "scientificName": "Aepyornis maximus", "lastSeen": "1600", "year": 1600, "image": "elephant_bird.png", "causeOfExtinction": ["Egg collection", "Hunting"] },
  { "name": "Broad-billed Parrot", "scientificName": "Lophopsittacus mauritianus", "lastSeen": "1670s", "year": 1675, "image": "broad_billed_parrot.png", "causeOfExtinction": ["Habitat destruction", "Hunting"] },
  { "name": "Dodo", "scientificName": "Raphus cucullatus", "lastSeen": "1681", "year": 1681, "image": "dodo.png", "causeOfExtinction": ["Hunting", "Invasive species"] },
  { "name": "Atlantic Gray Whale", "scientificName": "Eschrichtius robustus (Atlantic population)", "lastSeen": "1700s", "year": 1750, "image": "atlantic_gray_whale_copy.png", "causeOfExtinction": ["Hunting"] },
  { "name": "Mauritian Wood Pigeon", "scientificName": "Columba thiriouxi", "lastSeen": "1735", "year": 1735, "image": "mauritian_wood_pigeon.png", "causeOfExtinction": ["Habitat destruction", "Hunting"] },
  { "name": "Mauritius Turtle Dove", "scientificName": "Nesoenas cicur", "lastSeen": "1735", "year": 1735, "image": "mauritius_turtle_dove.png", "causeOfExtinction": ["Habitat destruction", "Hunting"] },
  { "name": "Steller's Sea Cow", "scientificName": "Hydrodamalis gigas", "lastSeen": "1768", "year": 1768, "image": "stellers_sea_cow.png", "causeOfExtinction": ["Overhunting"] },
  { "name": "Great Auk", "scientificName": "Pinguinus impennis", "lastSeen": "1844", "year": 1844, "image": "great_auk.png", "causeOfExtinction": ["Hunting for feathers, eggs, meat"] },
  { "name": "Quagga", "scientificName": "Equus quagga quagga", "lastSeen": "1883", "year": 1883, "image": "quagga.png", "causeOfExtinction": ["Hunting"] },
  { "name": "Newfoundland Wolf", "scientificName": "Canis lupus beothucus", "lastSeen": "1911", "year": 1911, "image": "newfoundland_wolf.png", "causeOfExtinction": ["Hunting", "Habitat loss"] },
  { "name": "Passenger Pigeon", "scientificName": "Ectopistes migratorius", "lastSeen": "1914", "year": 1914, "image": "passenger_pigeon.png", "causeOfExtinction": ["Habitat destruction", "Overhunting"] },
  { "name": "Carolina Parrot", "scientificName": "Conuropsis carolinensis", "lastSeen": "1918", "year": 1918, "image": "mauritius_grey_parrot.png", "causeOfExtinction": ["Habitat loss", "Hunting"] },
  { "name": "Tasmanian Tiger", "scientificName": "Thylacinus cynocephalus", "lastSeen": "1936", "year": 1936, "image": "tasmanian_tiger.png", "causeOfExtinction": ["Habitat loss", "Hunting"] },
  { "name": "Delalande's Coua", "scientificName": "Coua delalandei", "lastSeen": "1870", "year": 1870, "image": "delalandei_coua.png", "causeOfExtinction": ["Predation by introduced species"] },
  { "name": "Golden Toad", "scientificName": "Incilius periglenes", "lastSeen": "1989", "year": 1989, "image": "golden_toad.png", "causeOfExtinction": ["Climate change", "Habitat loss"] },
  { "name": "Pyrenean Ibex", "scientificName": "Capra pyrenaica pyrenaica", "lastSeen": "2000", "year": 2000, "image": "pyrenean_ibex.png", "causeOfExtinction": ["Hunting"] },
  { "name": "Baiji", "scientificName": "Lipotes vexillifer", "lastSeen": "2006", "year": 2006, "image": "baiji.png", "causeOfExtinction": ["Habitat destruction", "Pollution"] },
  { "name": "Western Black Rhinoceros", "scientificName": "Diceros bicornis longipes", "lastSeen": "2011", "year": 2011, "image": "black_rhino.png", "causeOfExtinction": ["Poaching"] },
  { "name": "Pinta Island Tortoise", "scientificName": "Chelonoidis abingdonii", "lastSeen": "2012", "year": 2012, "image": "pinta_tortoise.png", "causeOfExtinction": ["Habitat destruction", "Invasive species"] }
];

// ==================== Global Variables ====================
let species = [];
let images = {};
let timelineY = 260;
let canvasHeight;
let selected = null;

// ==================== p5.js ====================
function preload() {
  species = builtInData.map(s => ({...s}));
  species.forEach(s => images[s.image] = loadImage("images/" + s.image));
}

function setup() {
  canvasHeight = max(windowHeight, species.length * 260 + 400);
  createCanvas(windowWidth, canvasHeight);
  positionEverything();
}

function draw() {
  // Muji gradient background
  for (let y = 0; y < height; y++) {
    let c = lerpColor(color(245,245,240), color(230,230,225), y/height);
    stroke(c); line(0,y,width, y);
  }

  // Title
  fill(30); noStroke(); textAlign(CENTER, TOP);
  textSize(72); textStyle(BOLD);
  text("Last Witnesses", width/2, 60);

  // Subtitle
  textSize(28); textStyle(ITALIC); textLeading(48); fill(80);
  text("24 species that vanished during human history", width/2, 180);

  drawTimeline();
  drawAllSpecies();
  if (selected) drawInfoCard(selected);
}

function windowResized() {
  canvasHeight = max(windowHeight, species.length * 260 + 400);
  resizeCanvas(windowWidth, canvasHeight);
  positionEverything();
}

function mousePressed() {
  selected = null;
  for (let s of species) {
    if (dist(mouseX, mouseY, s.x, s.y) < 90) {
      selected = s;
      break;
    }
  }
}

// ==================== Position ====================
function positionEverything() {
  const startX = width/2;
  let y = timelineY + 120;
  const spacingY = 260;
  species.forEach((s,i) => {
    s.x = startX;
    s.y = y;
    // 左右交錯文字靠近圓圈
    s.offsetX = (i%2===0 ? -80 : 80);
    s.nameY = s.y;
    s.yearY = s.y + 24;
    y += spacingY;
  });
}

// ==================== Timeline ====================
function drawTimeline() {
  stroke(200); strokeWeight(5);
  line(width/2, timelineY, width/2, canvasHeight-50);

  noStroke(); fill(120); textSize(24); textAlign(CENTER);
  text("200,000 years ago", width/2, timelineY - 30);
  text("2024 CE", width/2, canvasHeight-40);
}

// ==================== Draw Species ====================
function drawAllSpecies() {
  species.forEach((s,i) => {
    // 圓圈
    fill(250,250,245); stroke(180); strokeWeight(4); 
    ellipse(s.x, s.y, 140, 140);

    // 圖片保持原比例
    if (images[s.image] && images[s.image].width) {
      push();
      translate(s.x, s.y);
      imageMode(CENTER);
      let ratio = images[s.image].width / images[s.image].height;
      let w = 124, h = w / ratio;
      image(images[s.image], 0, 0, w, h);
      pop();
    }

    // 名稱 & 年份 左右交錯
    noStroke(); fill(60); textFont('Georgia'); textSize(20); textStyle(ITALIC);
    textAlign(i%2===0?RIGHT:LEFT, CENTER);
    text(s.name, s.x + s.offsetX, s.nameY);
    textSize(16);
    text(s.lastSeen, s.x + s.offsetX, s.yearY);
  });
}

// ==================== Info Card ====================
function drawInfoCard(s) {
  const cardW = 520, cardH = 680;
  let cardX = constrain(mouseX+60, 40, width-cardW-40);
  let cardY = constrain(mouseY-cardH/2, 40, canvasHeight-cardH-40);

  fill(255,255,253); stroke(0,0,0,50); strokeWeight(6); rect(cardX, cardY, cardW, cardH, 28);

  fill(80); textAlign(LEFT,TOP); textSize(28); textStyle(ITALIC); textFont('Georgia');
  text(s.name, cardX+40, cardY+40);

  fill(80); textSize(20); textStyle(ITALIC);
  text("Last seen: " + s.lastSeen, cardX+40, cardY+100);

  fill(80); textSize(18); textStyle(ITALIC);
  text("Scientific name: " + s.scientificName, cardX+40, cardY+140);

  if (images[s.image]) {
    imageMode(CORNER);
    image(images[s.image], cardX+40, cardY+180, 440, 340);
    noFill(); stroke(0,0,0,50); strokeWeight(4); rect(cardX+40, cardY+180, 440, 340);
  }

  fill(80); textSize(18); textStyle(ITALIC); textLeading(28); textFont('Georgia');
  text("Cause of Extinction:\n• " + s.causeOfExtinction.join("\n• "), cardX+40, cardY+540, 440);
}
</script>
</body>
</html>
